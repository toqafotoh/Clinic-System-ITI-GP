@model Clinic_System.BLL.ModelVM.DepartmentVM.CreateDepartmentVM
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewBag.Title = "Manage Departments";
    var departments = ViewBag.Departments as List<Clinic_System.BLL.ModelVM.DepartmentVM.GetAllDepartmentsVM>;
}

<div class="add-department-container">
    <h3>Add New Department</h3>
    <form asp-action="CreateDepartment" method="post">
        <div>
            <label for="department-name">Department Name</label>
            <input type="text" id="department-name" asp-for="Name" placeholder="Department Name" class="form-control" required>
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
        <div>
            <label for="department-phone">Phone Number</label>
            <input type="text" id="department-phone" asp-for="PhoneNumber" placeholder="Phone Number" class="form-control" required>
            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
        </div>
        <button type="submit">Add Department</button>
    </form>
</div>

<table id="departments-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Phone Number</th>
            <th>Deleted Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var department in departments)
        {
            var isDeletedClass = department.IsDeleted ? "btn-danger" : "btn-success";
            var isDeletedText = department.IsDeleted ? "Deleted" : "Active";
            <tr>
                <td>@department.ID</td>
                <td>@department.Name</td>
                <td>@department.PhoneNumber</td>
                <td>
                    <button class="status-btn @isDeletedClass">@isDeletedText</button>
                </td>
                <td>
                    <a asp-action="EditDepartment" asp-route-id="@department.ID" class="edit-btn">Edit</a>
                    <button type="button" class="delete-btn" onclick="confirmDelete(@department.ID, '@department.Name')">
                        <i class="fas fa-trash-alt"></i> Delete
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Modal -->
<div class="modal fade" id="deleteDepartmentModal" tabindex="-1" role="dialog" aria-labelledby="deleteDepartmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteDepartmentModalLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><i class="fas fa-trash-alt"></i> Are you sure you want to delete the department <span id="departmentName"></span>?</p>
                <form id="deleteDepartmentForm" method="post" action="@Url.Action("DeleteDepartment", "Department")">
                    <input type="hidden" name="DepartmentID" id="departmentId" />
                    <div class="modal-footer">
                        <button type="button" class="btn btn-cancel" data-dismiss="modal">
                            <i class="fas fa-times btn-icon"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-delete">
                            <i class="fas fa-trash-alt btn-icon"></i> Delete
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    function confirmDelete(departmentId, departmentName) {
        document.getElementById('departmentName').textContent = departmentName;
        document.getElementById('departmentId').value = departmentId;
        $('#deleteDepartmentModal').modal('show');
    }

    document.getElementById('deleteDepartmentForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting the department.');
            });
    });
</script>
<style>
    /* Style the table */
    #departments-table {
        width: 100%;
        border-collapse: collapse;
    }

        /* Set the table header background color */
        #departments-table thead {
            background-color: #2d53c633;
        }

        /* Style table rows */
        #departments-table tbody tr {
            background-color: white;
        }

            /* Style table rows on hover */
            #departments-table tbody tr:hover {
                background-color: #f1f1f1;
            }

        /* Style table cells */
        #departments-table th,
        #departments-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        /* Style action buttons */
        #departments-table .edit-btn,
        #departments-table .delete-btn {
            border: none;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
        }

        #departments-table .edit-btn {
            background-color: #6ab470;
        }

        #departments-table .delete-btn {
            background-color: #dc3545;
        }

            #departments-table .edit-btn:hover,
            #departments-table .delete-btn:hover {
                opacity: 0.8;
            }

    /* Style status button based on department state */
    .status-btn {
        padding: 5px 10px;
        border-radius: 4px;
        border: none;
        font-size: 14px;
        color: white;
        cursor: default;
    }

    .btn-success {
        background-color: #28a745;
    }

    .btn-danger {
        background-color: #dc3545;
    }

    .add-department-container {
        background-color: #2d53c633;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 6px 6px 0px 0px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
    }

        .add-department-container h3 {
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #898686;
        }

        .add-department-container input {
            width: calc(100% - 20px);
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }

        .add-department-container button {
            background-color: #4E73DF;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 1rem;
        }

            .add-department-container button:hover {
                background-color: #0056b3;
            }
</style>
<style>
    /* Modal buttons */
    .modal-footer .btn-delete {
        background-color: #dc3545; /* Red color for delete button */
        color: #fff;
        border: none;
    }

    .modal-footer .btn-cancel {
        background-color: #d0e7f5; /* Light blue color for cancel button */
        color: #333;
        border: none;
    }

    .modal-footer .btn-icon {
        margin-right: 5px; /* Space between icon and text */
    }
</style>